#!/bin/env bash
values_dotfile="$HOME/.tmp_values.json"

while getopts ":t:n:" opt; do
    case $opt in
        t) [[ ${OPTARG} =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$ ]] && target=${OPTARG} || exit 1 ;;
        n) [[ ${OPTARG} =~ ^[0-9]{1,5}$ ]] && i=${OPTARG:+_${OPTARG}} || exit 1 ;;
        \?) echo "Invalid option -$OPTARG" >&2;;
    esac
done

if [[ -f $values_dotfile ]]; then
    m_json=$(jq ".target${i} = \"${target}\"" $values_dotfile)
    echo -n $m_json | jq '.' > $values_dotfile
else
    echo -n "{ \"target\": \"1.1.1.1\" }" | jq '.' > $values_dotfile
fi
