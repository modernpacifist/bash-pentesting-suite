#!/bin/env bash
values_dotfile="$HOME/.tmp_values.json"

function get_network_interfaces {
    for iface in $(ifconfig | rg -o "eth[0-9]|wlan[0-9]|tun[0-9]"); do
        echo $iface
        array_test+=($iface)
    done
    echo -n ${array_test[@]}
}

function get_intf_ip {
    ip=$(ifconfig | grep -A 1 ${1} | tail -1 | column -t | awk '{print $2}')

    if [[ $ip =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$ ]]; then
        echo $ip
    fi
}

function create_j_str {
    all_intfs=$(get_network_interfaces)

    for intf in ${all_intfs[@]}; do
        #intf_ip=$(ifconfig | grep -A 1 $intf | tail -1 | column -t | awk '{print $2}')
        #intf_g=$(netstat -rn 2>/dev/null | grep $intf | awk '{print $2}' | head -1 | tr -d "\n")
        #j_str+="\"${intf}_ip\": \"${intf_ip}\", \"${intf}_g\": \"${intf_g}\", "
        intf_ip=$(get_intf_ip ${intf})
        intf_g=$(netstat -rn 2>/dev/null | grep $intf | awk '{print $2}' | head -1 | tr -d "\n")
        j_str+="\"${intf}_ip\": \"${intf_ip}\", \"${intf}_g\": \"${intf_g}\", "
    done

    j_str+="\"port\": 4444,"
    j_str+="\"remote_host\": \"10.0.1.20\""

    echo -n $j_str
}

if [[ ! -f ${values_dotfile} ]]; then
    echo "{ $(create_j_str) }" | jq . > ${values_dotfile}
else
    target=$(jq '.target' ${values_dotfile} | tr -d '"')
fi

function ip_status {
    if ping -c 1 -W 0.5 $1 > /dev/null 2>&1; [[ $? -eq 0 ]]; then
        echo -n "UP" 
    else
        echo -n "DOWN"
    fi
}

function print_ports {
    echo "Ports:"
    echo -e "port: $(jq '.port' $values_dotfile)\n"
}

print_ports

function parse_field {
    value=$(jq ".$1" ${values_dotfile} | tr -d '"')

    if [[ $value != 'null' ]]; then
        echo $value
    else
        echo 
    fi
}

function print_options {
    parse_field eth0_ip
    parse_field tun0_ip
}

print_options
