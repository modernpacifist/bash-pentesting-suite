#!/bin/env bash
VALUES_DOTFILE="$HOME/.pentest_values.json"

if [[ -z $* ]]; then
    echo 'Usage: _port -p <int>'
    exit 1
fi

while getopts ":p:n:" opt; do
    case $opt in
        p) [[ ${OPTARG} =~ ^[0-9]{1,5}$ ]] && ((${OPTARG} >= 0 && ${OPTARG} <= 65535)) && port=${OPTARG} || exit 1 ;;
        #n) [[ ${OPTARG} =~ ^[0-9]{1,5}$ ]] && n=${OPTARG:+_${OPTARG}} || exit 1 ;;
        n) [[ ${OPTARG} =~ ^[0-9]{1,5}$ ]] && n=${OPTARG:+${OPTARG}} || exit 1 ;;
        \?) echo "Invalid option -$OPTARG" >&2 ;;
    esac
done

if [[ ! -f ${VALUES_DOTFILE} ]]; then
    echo -n "{ \"port${n}\": \"${port}\" }" | jq '.' > ${VALUES_DOTFILE}
else
    m_json=$(jq ".port${n} = \"${port}\"" ${VALUES_DOTFILE})
    echo -n $m_json | jq '.' > ${VALUES_DOTFILE}
fi
