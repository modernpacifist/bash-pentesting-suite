#!/usr/bin/env bash

function root_setup {
    find ./binfiles/ -type f -exec cp {} /bin/ \;

    if [[ -d /etc/bash_completion.d/ ]]; then
        find ./bash-completions/ -type f -exec cp {} /etc/bash_completion.d/ \;
    fi

    if [[ -d /etc/fish/completions/ ]]; then
        find ./fish-completions/ -type f -exec cp {} /etc/fish/completions/ \;
    fi
}

if [[ $EUID == 0 ]]; then
    root_setup
fi

function append_fish_config {
    readonly fish_config=~/.config/fish/config.fish

    if grep -Fxq 'function export_pentest_variables --on-event fish_prompt' $fish_config; then
        exit 0
    fi

    if [[ -f $fish_config ]]; then
cat << EOF >> $fish_config

function export_pentest_variables --on-event fish_prompt
    for s in (grep -E '": [^\{]' ~/.pentest_values.json 2>/dev/null | sed -e 's/: /=/' -e "s/\(\,\)\\\$//" | tr -d \"\ )
        export \$s
    end
end
EOF
    fi
}

case $SHELL in
    /usr/bin/fish) append_fish_config ;;
esac


exit 0
